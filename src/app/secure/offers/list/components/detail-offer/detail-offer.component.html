<section id="section-detail-offer" class="flexbox flex-wrap justify-center">

  <article class="detail-offer-img flexbox align-center justify-center flex-wrap">
    <div class="offer-button-back flexbox align-center">
      <button class="btn-back" mat-icon-button (click)="goToListOffers()">
        <mat-icon>arrow_back</mat-icon>
        <small class="sub-title-back">{{'secure.offers.list.components.detail_offer.return' | I18N | async}}</small>
      </button>
    </div>
    <div class="offer-img flexbox align-center justify-center">
      <img [src]="dataOffer.imageUrl" alt="">
      <div class="sold-out flexbox justify-center align-center" *ngIf="dataOffer.stock === 0 || !dataOffer.stock">
        <div class="flexbox justify-center align-center">
          <p>{{'secure.offers.list.list.with_out_stock' | I18N | async}}</p>
        </div>
      </div>
    </div>
  </article>

  <article class="detail-offer-desc flexbox flex-wrap justify-between">

    <p class="ean flexbox align-center">{{'secure.offers.list.list.EAN_offert' | I18N | async}} {{dataOffer.ean}}</p>

    <div class="btn-edit-offer flexbox justify-end">
      <button type="button" color="primary" [matTooltip]="'actions.edit' | I18N | async" matTooltipPosition="below"
        mat-icon-button mat-button (click)="editOffer()" *ngIf="!isUpdateOffer && isUpdateOffer === false && canEdit">
        <mat-icon class="flexbox align-center justify-center">edit</mat-icon>
      </button>
      <button type="button" color="primary" [matTooltip]="'actions.cancel_min' | I18N | async"
        matTooltipPosition="below" mat-icon-button mat-button (click)="cancelEditOffer()"
        *ngIf="isUpdateOffer && isUpdateOffer === true">
        <mat-icon class="flexbox align-center justify-center">close</mat-icon>
      </button>
    </div>

    <p [innerHTML]="dataOffer.name" class="name"></p>

    <div class="container-data-offer" *ngIf="!isUpdateOffer && isUpdateOffer === false">

      <p *ngIf="dataOffer.discountPrice > 0" [innerHTML]="dataOffer.price | currency: '$' : 'symbol' : '1.2-2'"
        class="price-strikethrough"></p>

      <p [innerHTML]="dataOffer.discountPrice > 0 ? (dataOffer.discountPrice | currency: '$' : 'symbol' : '1.2-2') : (dataOffer.price | currency: '$' : 'symbol' : '1.2-2')"
        class="price"></p>

      <div class="container-stock flexbox">
        <!-- <p [innerHTML]="'ID de Oferta: <strong> &nbsp;' + dataOffer.idOffer + '</strong>&nbsp;'"
            class="stock flexbox flex-wrap align-center separator"> -->
        <p class="stock flexbox flex-wrap align-center separator">
          {{'secure.offers.list.components.detail_offer.id_offer' | I18N | async}}<strong>{{dataOffer.idOffer}}</strong>
        </p>
        <p *ngIf="dataOffer.stock > 0" class="stock flexbox flex-wrap align-center padding-left-1">
          {{'secure.offers.list.components.detail_offer.in_stock' | I18N | async}}
          <strong>{{dataOffer.stock | number}}</strong></p>
        <p *ngIf="!dataOffer.stock > 0">
          {{'secure.offers.list.components.detail_offer.in_stock' | I18N | async}}
          <strong>{{'secure.offers.list.list.with_out_stock' | I18N | async}}</strong>
        </p>
      </div>

      <span class="flexbox align-center" *ngIf="dataOffer.size">
        <mat-icon>tab_unselected</mat-icon>
        <p>{{'secure.products.bulk_upload.size' | I18N | async}}: <strong>{{dataOffer.size}}</strong></p>
      </span>

      <span class="flexbox align-center" *ngIf="dataOffer.hexColourCodePDP">
        <mat-icon>color_lens</mat-icon>
        <p class="text-color">{{'secure.products.bulk_upload.color' | I18N | async}}</p>
        <mat-icon [ngStyle]="{'color':'#' + dataOffer.hexColourCodePDP}">brightness_1</mat-icon>
      </span>

      <span class="flexbox align-center">
        <mat-icon>date_range</mat-icon>
        <p>
          {{'secure.offers.historical_admin.historical_admin.promise' | I18N | async}}
          <strong>{{dataOffer.promiseDelivery}}</strong>
          {{'secure.offers.list.components.detail_offer.business_days' | I18N | async}}</p>
      </span>

      <span class="flexbox align-center">
        <mat-icon>local_shipping</mat-icon>
        <p>
          {{'secure.offers.list.components.detail_offer.averageFreightCost' | I18N | async}}
          <strong>{{dataOffer.shippingCost | currency: '$' : 'symbol' : '1.2-2'}}</strong>
        </p>
      </span>

      <span class="flexbox align-center">
        <mat-icon>beenhere</mat-icon>
        <p>
          {{'secure.offers.historical_admin.historical_admin.warranty' | I18N | async}}
          <strong>{{dataOffer.warranty}} {{'secure.offers.list.components.detail_offer.months' | I18N | async}}</strong>
        </p>
      </span>
      <span class="flexbox align-center">
        <mat-icon>attach_money</mat-icon>
        <p>
          {{'secure.offers.historical_admin.historical_admin.warranty' | I18N | async}}
          <strong>{{dataOffer.currency}}</strong></p>
      </span>

      <aside class="flexbox align-center justify-center flex-wrap">
        <div class="flexbox align-center justify-center sep-right" [ngClass]="{'check' : dataOffer.isFreeShipping}">
          <mat-icon *ngIf="dataOffer.isFreeShipping && dataOffer.isFreeShipping === true">check</mat-icon>
          <mat-icon *ngIf="!dataOffer.isFreeShipping || dataOffer.isFreeShipping === false">clear</mat-icon>
          <p>{{'secure.offers.historical_admin.historical_admin.free_shipping' | I18N | async}}</p>
        </div>
        <div class="flexbox align-center justify-center" [ngClass]="{'check' : dataOffer.isEnviosExito}">
          <mat-icon *ngIf="dataOffer.isEnviosExito && dataOffer.isEnviosExito === true">check</mat-icon>
          <mat-icon *ngIf="!dataOffer.isEnviosExito || dataOffer.isEnviosExito === false">clear</mat-icon>
          <p>{{'secure.offers.historical_admin.historical_admin.shiping_exito' | I18N | async}}</p>
        </div>
        <div class="flexbox align-center justify-center sep-right sep-top"
          [ngClass]="{'check' : dataOffer.isFreightCalculator}">
          <mat-icon *ngIf="dataOffer.isFreightCalculator && dataOffer.isFreightCalculator === true">check</mat-icon>
          <mat-icon *ngIf="!dataOffer.isFreightCalculator || dataOffer.isFreightCalculator === false">clear</mat-icon>
          <p>{{'secure.offers.historical_admin.historical_admin.freight_calculator' | I18N | async}}</p>
        </div>
        <div class="flexbox align-center justify-center sep-top" [ngClass]="{'check' : dataOffer.isLogisticsExito}">
          <mat-icon *ngIf="dataOffer.isLogisticsExito && dataOffer.isLogisticsExito === true">check</mat-icon>
          <mat-icon *ngIf="!dataOffer.isLogisticsExito || dataOffer.isLogisticsExito === false">clear</mat-icon>
          <p>{{'secure.offers.historical_admin.historical_admin.exito_logistic' | I18N | async}}</p>
        </div>
      </aside>
      <p class="udpade-date">
        {{'secure.offers.list.components.detail_offer.last_modify' | I18N | async}}
        {{dataOffer.lastUpdate | date : 'dd/MM/yyyy'}}
      </p>
    </div>

    <div class="container-form-edit-offer" *ngIf="isUpdateOffer && isUpdateOffer === true">

      <form #updateOffer="ngForm" [formGroup]="formUpdateOffer" (ngSubmit)="submitUpdateOffer()"
        class="flexbox flex-wrap align-center justify-between" autocomplete="off">
        <mat-form-field>
          <input matInput [placeholder]="'secure.offers.historical_admin.historical_admin.stock' | I18N | async"
            id="detail-offer-stock" formControlName="Stock" (keypress)="onlyNumber($event)" required>
          <mat-hint></mat-hint>
          <mat-error *ngIf="formUpdateOffer.get('Stock').hasError('required')">
            {{'errors.error_required' | I18N | async}}</mat-error>
        </mat-form-field>

        <mat-form-field>
          <input matInput [placeholder]="'secure.offers.historical_admin.historical_admin.price' | I18N | async"
            id="detail-offer-Price" formControlName="Price" [errorStateMatcher]="matcher" (blur)="validInput('Price')"
            required>
          <mat-hint></mat-hint>
          <mat-error *ngIf="formUpdateOffer.get('Price').hasError('required')">
            {{'errors.error_required' | I18N | async}}
          </mat-error>
          <mat-error *ngIf="formUpdateOffer.get('Price').hasError('pattern')">
            {{'errors.format_invalidate' | I18N | async}}
          </mat-error>
          <mat-error
            *ngIf="!formUpdateOffer.get('Price').hasError('required') && formUpdateOffer.get('Price').hasError('isLessThanEightThousand')">
            {{'errors.error_price' | I18N | async}}</mat-error>
          <mat-error
            *ngIf="!formUpdateOffer.get('Price').hasError('required') && formUpdateOffer.get('Price').hasError('isLessThanDiscPrice')">
            {{'errors.error_price_dscto' | I18N | async}}</mat-error>
        </mat-form-field>

        <mat-form-field>
          <input matInput
            [placeholder]="'secure.offers.historical_admin.historical_admin.discount_price' | I18N | async"
            [errorStateMatcher]="matcher" formControlName="DiscountPrice" (blur)="validInput('DiscountPrice')">
          <mat-hint></mat-hint>
          <mat-error *ngIf="formUpdateOffer.get('DiscountPrice').hasError('pattern')">
            {{'errors.format_invalidate' | I18N | async}}
          </mat-error>
          <mat-error *ngIf="formUpdateOffer.get('DiscountPrice').hasError('isLessThanEightThousand')">
            {{'errors.error_price_discount' | I18N | async}}</mat-error>
          <mat-error *ngIf="formUpdateOffer.get('DiscountPrice').hasError('isgreaterThanPrice')">
            {{'errors.error_price_discount_2' | I18N | async}}</mat-error>
        </mat-form-field>

        <mat-form-field>
          <input matInput [placeholder]="'secure.offers.list.components.detail_offer.averageFreightCost' | I18N | async"
            formControlName="AverageFreightCost" [errorStateMatcher]="matcher" required>
          <mat-hint></mat-hint>
          <mat-error *ngIf="formUpdateOffer.get('AverageFreightCost').hasError('pattern')">
            {{'errors.format_invalidate' | I18N | async}}</mat-error>
          <mat-error *ngIf="formUpdateOffer.get('AverageFreightCost').hasError('required')">
            {{'errors.error_required' | I18N | async}}</mat-error>
        </mat-form-field>

        <mat-form-field>
          <input matInput [placeholder]="'secure.offers.historical_admin.historical_admin.promise' | I18N | async"
            formControlName="PromiseDelivery" (blur)="validInput('PromiseDelivery')" required>
          <mat-hint></mat-hint>
          <mat-error *ngIf="formUpdateOffer.get('PromiseDelivery').hasError('pattern') ||
                        formUpdateOffer.get('PromiseDelivery').hasError('startIsGreaterThanEnd') || 
                        formUpdateOffer.get('PromiseDelivery').hasError('isInvaldStart') ||
                        formUpdateOffer.get('PromiseDelivery').hasError('isInvalidEnd')">
            {{'errors.error_promise' | I18N | async}}</mat-error>
          <mat-error *ngIf="formUpdateOffer.get('PromiseDelivery').hasError('required')">
            {{'errors.error_required' | I18N | async}}</mat-error>
        </mat-form-field>
        <mat-form-field>
          <input matInput [placeholder]="'secure.offers.historical_admin.historical_admin.warranty' | I18N | async"
            formControlName="Warranty" required (keypress)="onlyNumber($event)">
          <mat-hint></mat-hint>
          <mat-error *ngIf="formUpdateOffer.get('Warranty').hasError('required')">
            {{'errors.error_required' | I18N | async}}</mat-error>
        </mat-form-field>
        <mat-form-field>
          <mat-label>{{'secure.offers.historical_admin.historical_admin.currency' | I18N | async}}</mat-label>
          <mat-select name="Currency" formControlName="Currency" (ngModelChange)="changeTypeCurrency($event)"
            [disabled]="true">
            <mat-option value="USD">{{'secure.offers.list.components.detail_offer.usd' | I18N | async}}</mat-option>
            <mat-option value="COP">{{'secure.offers.list.components.detail_offer.cop' | I18N | async}}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-slide-toggle color="primary" formControlName="IsFreeShipping"
          (change)="checkSlide($event, 'isFreeShipping')">
          {{'secure.offers.historical_admin.historical_admin.free_shipping' | I18N | async}}
        </mat-slide-toggle>

        <mat-slide-toggle color="primary" formControlName="IsEnviosExito"
          (change)="checkSlide($event, 'isEnviosExito')">
          {{'secure.offers.historical_admin.historical_admin.shiping_exito' | I18N | async}}</mat-slide-toggle>

        <mat-slide-toggle color="primary" formControlName="IsFreightCalculator"
          (change)="checkSlide($event, 'isFreightCalculator')">
          {{'secure.offers.historical_admin.historical_admin.freight_calculator' | I18N | async}}</mat-slide-toggle>

        <mat-slide-toggle color="primary" formControlName="IsLogisticsExito"
          (change)="checkSlide($event, 'IsLogisticsExito')">
          {{'secure.offers.historical_admin.historical_admin.exito_logistic' | I18N | async}}
        </mat-slide-toggle>

        <mat-slide-toggle color="primary" formControlName="IsUpdatedStock"
          (change)="checkSlide($event, 'IsUpdatedStock')">
          {{'secure.offers.list.components.detail_offer.update_stock' | I18N | async}}</mat-slide-toggle>

        <div class="button-update-offert flexbox justify-center align-center">
          <button [disabled]="!updateOffer.form.valid" type="submit" mat-raised-button color="primary">
            {{'actions.edit' | I18N | async}}
          </button>
        </div>

      </form>
    </div>
  </article>
</section>
