<!-- FORM CONTAINER -->
<div fxFlex="100" fxLayout="column" class="basic-info-container" *ngIf="formCreate" id="textCreateBasicInfo">
  <p>En esta sección deberás diligenciar la información básica del producto a crear. Recuerda que todos los campos
    deben estar diligenciado correctamente o no podrás avanzar. Si tu producto es variante debes agregar cada
    variación como un "hijo" diligenciando completamente la información de cada uno en la parte inferior de la
    sección</p>

  <!-- BASIC INFORMATION FORM-->
  <form class="basic-info" [formGroup]="formBasicInfo" (ngSubmit)="saveBasicInfo()">

    <!-- NAME AND CATEGORY -->
    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutAlign.xs="center center" fxLayout.xs="column">
      <mat-form-field class="name-product field">
        <input matInput placeholder="Nombre del producto" class="input-name-product" formControlName="Name" (change)="detectForm()"
          id="nameProduct" autofocus required>
        <mat-error *ngIf="formBasicInfo.get('Name').hasError('pattern')">El formato es inv&aacute;lido</mat-error>
        <mat-error *ngIf="formBasicInfo.get('Name').hasError('required')">Este campo es obligatorio</mat-error>
      </mat-form-field>

      <mat-form-field class="category-product field">
        <input matInput placeholder="Categoria" class="input-category-product" formControlName="Category" (change)="detectForm()"
          id="categoryProduct">
      </mat-form-field>
    </div>

    <!-- BRAND AND MODEL -->
    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutAlign.xs="center center" fxLayout.xs="column">
      <mat-form-field class="brand-product field">
        <input matInput placeholder="Marca" class="input-brand-product" formControlName="Brand" (change)="detectForm()"
          id="brandProduct">
        <mat-error *ngIf="formBasicInfo.get('Brand').hasError('pattern')">La marca ingresada no es v&aacute;lido</mat-error>
        <mat-error *ngIf="formBasicInfo.get('Brand').hasError('required')">Este campo es obligatorio</mat-error>
      </mat-form-field>

      <!-- <mat-form-field class="field">
          <mat-select placeholder="Marca" formControlName="Brand" id="Brand" (selectionChange)="detectForm()" required>
            <mat-option *ngFor="let brand of brands" [value]="brand.Name">
              {{brand.Name}}
            </mat-option>
          </mat-select> 
          
          <mat-error *ngIf="formBasicInfo.get('Brand').hasError('required')">Este campo es obligatorio</mat-error>
        </mat-form-field>-->

      <mat-form-field class="model-product field">
        <input matInput placeholder="Modelo" class="input-model-product" formControlName="Model" (change)="detectForm()"
          id="modelProduct" required>
        <mat-error *ngIf="formBasicInfo.get('Model').hasError('pattern')">El modelo ingresado no es v&aacute;lido</mat-error>
        <mat-error *ngIf="formBasicInfo.get('Model').hasError('required') && formBasicInfo.get('Model').touched">Este campo es obligatorio</mat-error>
      </mat-form-field>
    </div>

    <!-- DETAIL AND SHIPPING SIZE -->
    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutAlign.xs="center center" fxLayout.xs="column">
      <mat-form-field class="detail-product field">
        <input matInput placeholder="Detalle" class="input-detail-product" formControlName="Detail" (change)="detectForm()"
          id="detailProduct" required>
        <mat-error *ngIf="formBasicInfo.get('Detail').hasError('pattern')">El detalle ingresado no es v&aacute;lido</mat-error>
        <mat-error *ngIf="formBasicInfo.get('Detail').hasError('required')">Este campo es obligatorio</mat-error>
      </mat-form-field>

      <div class="shipping-product field">
        <label class="label-shipping">Shipping size</label>
        <mat-slider min="1" max="5" tickInterval="true" class="shipping-slider" (change)="detectForm()" formControlName="shippingSize"
          id="shippingProduct"></mat-slider>
        <div fxLayout="row" fxLayoutAlign="space-between center" class="items-slider">
          <label class="items-slider-label">1</label>
          <label class="items-slider-label">2</label>
          <label class="items-slider-label">3</label>
          <label class="items-slider-label">4</label>
          <label class="items-slider-label">5</label>
        </div>
      </div>
    </div>

    <!-- PACKING AND PRODUCT SIZE -->
    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutAlign.xs="center center" fxLayout.xs="column"
      class="container-sub-forms">
      <div class="sub-form" formGroupName="packing">
        <label class="label-shipping">Empaque (cm/kg)</label>
        <div fxLayout="row" fxLayout.xs="column" fxLayoutAlign="space-between center">
          <div class="packing-sub-level" fxLayout="row" fxLayoutAlign="space-between center">
            <mat-form-field class="packing-field">
              <input matInput placeholder="Alto" class="input-packing-high" formControlName="HighPacking" (change)="detectForm()"
                id="highPackingProduct" required>
              <mat-error *ngIf="formBasicInfo.controls.packing.get('HighPacking').hasError('pattern')">La dimensión
                ingresada no es v&aacute;lida</mat-error>
                <mat-error *ngIf="formBasicInfo.controls.packing.get('HighPacking').hasError('required')">Este campo es obligatorio</mat-error>
            </mat-form-field>
            <mat-form-field class="packing-field">
              <input matInput placeholder="Largo" class="input-packing-long" formControlName="LongPacking" (change)="detectForm()"
                id="longPackingProduct" required>
              <mat-error *ngIf="formBasicInfo.controls.packing.get('LongPacking').hasError('pattern')">La dimensión
                ingresada no es válida</mat-error>
                <mat-error *ngIf="formBasicInfo.controls.packing.get('LongPacking').hasError('required')">Este campo es obligatorio</mat-error>
            </mat-form-field>
          </div>
          <div class="packing-sub-level" fxLayout="row" fxLayoutAlign="space-between center">
            <mat-form-field class="packing-field">
              <input matInput placeholder="Ancho" class="input-packing-width" formControlName="WidthPacking" (change)="detectForm()"
                id="widthPackingProduct" required>
              <mat-error *ngIf="formBasicInfo.controls.packing.get('WidthPacking').hasError('pattern')">La dimensión
                ingresada no es válida</mat-error>
                <mat-error *ngIf="formBasicInfo.controls.packing.get('WidthPacking').hasError('required')">Este campo es obligatorio</mat-error>
            </mat-form-field>
            <mat-form-field class="packing-field">
              <input matInput placeholder="Peso" class="input-packing-weight" formControlName="WeightPacking" (change)="detectForm()"
                id="weightPackingProduct" required>
              <mat-error *ngIf="formBasicInfo.controls.packing.get('WeightPacking').hasError('pattern')">La dimensión
                ingresada no es válida</mat-error>
                <mat-error *ngIf="formBasicInfo.controls.packing.get('WeightPacking').hasError('required')">Este campo es obligatorio</mat-error>

            </mat-form-field>
          </div>
        </div>
      </div>
      <div class="sub-form product-form" formGroupName="product">
        <label class="label-shipping">Producto (cm/kg)</label>
        <div fxLayout="row" fxLayout.xs="column" fxLayoutAlign="space-between center">
          <div class="packing-sub-level" fxLayout="row" fxLayoutAlign="space-between center">
            <mat-form-field class="packing-field">
              <input matInput placeholder="Alto" class="input-packing-high" formControlName="HighProduct" (change)="detectForm()"
                id="highProduct" required>
              <mat-error *ngIf="formBasicInfo.controls.product.get('HighProduct').hasError('pattern')">La dimensión
                ingresada no es v&aacute;lida</mat-error>
                <mat-error *ngIf="formBasicInfo.controls.product.get('HighProduct').hasError('required')">Este campo es obligatorio</mat-error>
            </mat-form-field>
            <mat-form-field class="packing-field">
              <input matInput placeholder="Largo" class="input-packing-long" formControlName="LongProduct" (change)="detectForm()"
                id="longProduct" required>
              <mat-error *ngIf="formBasicInfo.controls.product.get('LongProduct').hasError('pattern')">La dimensión
                ingresada no es válida</mat-error>
                <mat-error *ngIf="formBasicInfo.controls.product.get('LongProduct').hasError('required')">Este campo es obligatorio</mat-error>

            </mat-form-field>
          </div>
          <div class="packing-sub-level" fxLayout="row" fxLayoutAlign="space-between center">
            <mat-form-field class="packing-field">
              <input matInput placeholder="Ancho" class="input-packing-width" formControlName="WidthProduct" (change)="detectForm()"
                id="widthProduct" required>
              <mat-error *ngIf="formBasicInfo.controls.product.get('WidthProduct').hasError('pattern')">La dimensión
                ingresada no es válida</mat-error>
                <mat-error *ngIf="formBasicInfo.controls.product.get('WidthProduct').hasError('required')">Este campo es obligatorio</mat-error>

            </mat-form-field>
            <mat-form-field class="packing-field">
              <input matInput placeholder="Peso" class="input-packing-weight" formControlName="WeightProduct" (change)="detectForm()"
                id="weightProduct" required>
              <mat-error *ngIf="formBasicInfo.controls.product.get('WeightProduct').hasError('pattern')">La dimensión
                ingresada no es válida</mat-error>
                <mat-error *ngIf="formBasicInfo.controls.product.get('WeightProduct').hasError('required')">Este campo es obligatorio</mat-error>

            </mat-form-field>
          </div>
        </div>
      </div>
    </div>


    <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutAlign.xs="center center" fxLayout.xs="column">
      <mat-form-field class="field">
        <mat-select placeholder="Unidad de medida" formControlName="MeasurementUnit" (change)="detectForm()" required>
          <mat-option *ngFor="let unit of UnitMeasurementList" [value]="unit">
            {{unit}}
          </mat-option>
        </mat-select>
        
        <mat-error *ngIf="formBasicInfo.get('MeasurementUnit').hasError('required')">Este campo es obligatorio</mat-error>
      </mat-form-field>

      <mat-form-field class="field">
        <input matInput placeholder="Factor de conversión" class="input-packing-width" formControlName="ConversionFactor"
          (change)="detectForm()" id="conversionFactorProduct" required>
        <mat-error *ngIf="formBasicInfo.get('ConversionFactor').hasError('required')">Este campo es obligatorio</mat-error>
        <mat-error *ngIf="formBasicInfo.get('ConversionFactor').hasError('pattern')">El formato no es válido</mat-error>
      </mat-form-field>
    </div>

    <div fxLayout="column" fxLayoutAlign="space-between center" fxLayoutAlign.xs="center center" fxLayout.xs="column" style="width: 100%;">
      <angular-editor formControlName="Description" id="Description" [config]="config" style="width: 100%;" (change)="detectForm()" required></angular-editor>
      <mat-error *ngIf="formBasicInfo.get('Description').hasError('required') && formBasicInfo.get('Description').touched">Este campo es obligatorio</mat-error>
      <mat-error *ngIf="formBasicInfo.get('Description').hasError('pattern')">El formato no es válido</mat-error>
    </div>

    <mat-form-field class="keyword-field">
        <input type="tel" matInput placeholder="Palabras clave" formControlName="Keyword" id="keywordProduct" (keyup.enter)="saveKeyword()" required>
        <mat-icon matSuffix class="material-icons" (click)="saveKeyword()"  class="add-keyword-icon">
          add_circle_outline
        </mat-icon>
        <div class="basic-info-error" *ngIf="keywords.length<1 && formBasicInfo.get('Keyword').touched">Este campo es obligatorio</div>
      </mat-form-field>
  </form>

  <!-- FORM KEYWORD-->
  <!-- <form [formGroup]="formKeyword" (ngSubmit)="saveKeyword()" class="form-keyword">
  
  </form> -->
  <div style="flex-wrap: wrap; display: flex;">
    <div *ngFor="let key of keywords; let i = index">
      <span>
        {{key}}
      </span>
      <button mat-icon-button (click)="deleteKeywork(i)">
        <mat-icon class="material-icons">
          close
        </mat-icon>
      </button>
    </div>
  </div>
  <mat-divider></mat-divider>

  <!-- BUTTON TO ADD SONS -->
  <div fxLayout="row" fxLayoutAlign="space-between center" *ngIf="productData.ProductType === 'Clothing'" class="sticky-position">
    <div>
    </div>
    <button fxLayout="row" fxLayoutAlign="center center" class="add-son-button" mat-button (click)="addSon()">
      <mat-icon class="material-icons">
        add_circle_outline
      </mat-icon>
      <span>Añadir hijo</span>
    </button>
  </div>

  <!-- SON LIST -->
  <div *ngFor="let son of sonList; let i = index" fxLayout="column">
    <div fxLayout="row" fxLayoutAlign="space-between center" class="border-bottom-gray">
      <label>
        Agregar hijo {{i+1}}
      </label>
      <button mat-icon-button (click)="toggleSon(son)">
        <mat-icon class="material-icons" *ngIf="son.Show">
          expand_less
        </mat-icon>
        <mat-icon class="material-icons" *ngIf="!son.Show">
          expand_more
        </mat-icon>
      </button>
    </div>
    <!-- SHOW FORM -->
    <div *ngIf="son.Show" class="son-container">

      <div class="text-right">
        <button mat-icon-button matTooltip="Eliminar hijo" (click)="deleteSon(i)">
          <mat-icon class="material-icons">
            delete
          </mat-icon>
        </button>
      </div>

      <!-- SON FORM -->
      <form [formGroup]="son.form" (ngSubmit)="saveBasicInfo()">

        <!-- EAN SON AND SIZE -->
        <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutAlign.xs="center center" fxLayout.xs="column">
          <!-- EAN -->
          <div class="name-product field">
            <mat-form-field id="inputValidEanSon">
              <input matInput placeholder="Ean hijo" class="input-name-product" formControlName="Ean" (blur)="validateEanSon()"
                (change)="detectForm()" id="validateEanSonProduct">
              <mat-error *ngIf="son.form.get('Ean').hasError('pattern')">El EAN ingresado no es v&aacute;lido</mat-error>
              <mat-error *ngIf="son.form.controls.Ean.errors &&  son.form.controls.Ean.errors.validExistEanSonDB">El
                EAN ya existe, por favor asocia una multioferta.</mat-error>
              <mat-error *ngIf="son.form.get('Ean').hasError('required')">El campo es obligatorio</mat-error>
            </mat-form-field>
            <div class="distanceComponetInt">
              <mat-checkbox #asignatedEanSonCheckBox [checked]="asignatedEanSon" (change)="onAsignatedEanSonChanged(asignatedEanSonCheckBox.checked, son.form.get('Ean'))"
                formControlName="associateEanSon" id="associateEanSon">No tengo EAN asociado</mat-checkbox>
            </div>
          </div>

          <mat-form-field class="category-product field">
              <mat-label>Ingresa la talla</mat-label>
              <mat-select formControlName="Size">
                <mat-option *ngFor="let size of sizes" (change)="detectForm()"  class="input-category-product" [value]="size.size">
                  {{size.size}}
                </mat-option>
              </mat-select>
            <mat-error *ngIf="son.form.get('Size').hasError('pattern')">La talla ingresada no es v&aacute;lida</mat-error>
            <mat-error *ngIf="son.form.get('Size').hasError('required')">EL campo es obligatorio</mat-error>
          </mat-form-field>
        </div>

        <div fxLayout="row" fxLayout.xs="column" fxLayoutAlign="space-between center">

          <div class="field">
            <label class="label-color">Color</label>
            <div class="full-width flex-container">
              <div class="container-color" *ngFor="let color of colorList">
                <div class="color-round-picker" [ngStyle]="{'background-color': color.color, 'border-color': color.border}"
                  *ngIf="!color.multicolor" [matTooltip]="color.Name" (click)="selectColor(color, son)" [ngClass]="{'select-color': color.Name === son.colorSelected}">
                </div>
                <div class="material-icons multi-color" (click)="selectColor(color, son)" [ngClass]="{'select-color': color.Name === son.colorSelected}"
                  *ngIf="color.multicolor" [matTooltip]="color.Name">
                  <div class="multi-one"></div>
                  <div class="multi-two"></div>
                  <div class="multi-three"></div>
                  <div class="multi-four"></div>
                  <div class="multi-five"></div>
                  <div class="multi-six"></div>
                </div>
              </div>
            </div>
          </div>

          <mat-form-field class="field">
            <mat-icon matPrefix class="material-icons color-prefix-icon" [ngStyle]="{'border-color': invertColor(son.colorPick), 'background-color': son.colorPick }"></mat-icon>
            <input matInput placeholder="HexColorCodePDP" [value]="son.colorPick" formControlName="HexColorCodePDP" id="HexColorCodePDP">
            <mat-icon matSuffix class="material-icons color-icon-picker" [cpPosition]="'left'" [(colorPicker)]="son.colorPick"
              (colorPickerChange)="detectForm()" [style.background]="colorPick" [cpOutputFormat]="hex" [cpPresetColors]="['#fff', '#000', '#2889e9', '#e920e9', '#fff500', '#f44336']">
              palette
            </mat-icon>
            <div class="basic-info-error" *ngIf="!son.colorPick && son.dirty">Este campo es obligatorio</div>
          </mat-form-field>
        </div>

        <mat-form-field class="category-product field">
          <input matInput placeholder="Nombre específico de color" formControlName="HexColorCodeName" (change)="detectForm()" id="hexColorNameProduct">
          <mat-error *ngIf="son.form.get('HexColorCodeName').hasError('pattern')">El Nombre específico de color ingresado no es
            v&aacute;lido, no debe tener espacios.</mat-error>
          <mat-error *ngIf="son.form.get('HexColorCodeName').hasError('required')">EL campo es obligatorio</mat-error>
        </mat-form-field>

      </form>
    </div>
  </div>
</div>